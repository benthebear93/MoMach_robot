# (~3/12) Imu 센서 현상황 정리

##### <자이로 센서>

자이로 센서의 경우 적분하여 RPY값을 얻을 수 있긴 하다.

다만, drift현상으로 오차값이 계속 커지는 걸 알 수 있다. 

##### **<가속도 센서>**

가속도 센서의 경우 수학적으로 계산하여 Roll, Pitch값을 알 수 있다.

다만, Noise에 취약하여 값이 많이 진동하는 것을 알 수 있다.

##### **<융합>**

따라서 자이로 센서와 가속도 센서의 값을 합쳐 필터를 거쳐야한다.



##### 문제점

1. Yaw값의 경우 자이로센서와 가속도 센서로는 정확히 알 수 없다.

   : 지자기 센서를 추가 구매하여 자이로센서 값과 융합한다.

2. 센서 테스트를 해봐야하는데 환경이 열약하다.

   : 기존 모바일 로봇에 올려서 테스트 해본다, 다이나믹셀이 올때까지 기다렸다 테스트해본다.

##### 현재 할 수 있는 것

- sampling time을 정확히 측정해본다. 

- RPY값을 자이로, 가속도, 상보필터를 거쳐 정확도를 확인한다.

- RPY값을 오일러 변환으로 나타내고, 쿼터니안으로 나타내서(Eigen) sensor_msgs/Imu로 만든다.

- TF를 설정해준다.




노드와 토픽 정리

토픽 : acc_x, acc_y, acc_z,                                 (토픽 필요없음)

​		  gyro_x, gyro_y, gyro_z                     ----> gyro_r, gyro_p, gyro_y로 바꾸기

​          acc_roll, acc_pitch,                           ---->

​          filtered_roll, filtered_pitch              ---->

버퍼 : gyro_buff, acc_buff, RPY_buff, filitered_rpy 있음



함수:

- gyro_to_angle                                      ----> gyro_integration
- rad2deg                                                ----> 
- RP_calculate                                         ---->
- Complentary                                        ----> CF(?)



데이터 처리 순서 :

| 자이로센서                            | 가속도센서                            |
| ------------------------------------- | ------------------------------------- |
| Unit 통일 - rad to deg                |                                       |
| 적분 후 버퍼에 값 넣기(필터에 사용됨) | 계산 후 버퍼에 값 넣기(필터에 사용됨) |
| 버퍼값을 토픽에 넣기                  | 버퍼값을 토픽에 넣기                  |
| 최종으로 토픽 퍼블리시                | 최종으로 토픽 퍼블리시                |



Unit 통일 - rad to deg|데이터 버퍼에 넣기

gyro_buff -deg

RPY_buff - deg



적분 후 값 버퍼에 넣기 (추후 필터에 넣을 때 사용)

버퍼값을 토픽 데이터에 넣기



